---
output: pdf_document
editor_options: 
  chunk_output_type: console
---

# What determines community level parkrun participation? 

*Smith R^1^,Schneider PP^1^*

\begingroup\small
*^1^ScHARR* 
\endgroup

<br>

  __Keywords__:  `parkrun`, `Participation`, `Physical Activity`, `Equity`, `Ethnicity`.  
  
  __Intended Journal__: Journal of Racial & Ethnic Health Disparities, Sports Medicine Open,Behavioural and Social Sciences, Journal Of Epi & Comm Health.


****  


```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      comment = NA, 
                      warning = FALSE, 
                      error = FALSE, 
                      message = FALSE, 
                      tidy = TRUE)
# knitr::opts_knit$set(root.dir = 'C:/Users/Robert/Google Drive/Other Projects/PARKRUN/DoPE')


```
# Abstract

parkrun is very successful in encouraging people in England to participate in weekly 5km runs. However, previous analyses have shown that there is substantial heterogeneity in parkrun participation across different communities in England: after controlling for travel distances, deprived communities have significantly lower participation rates (Schneider et al. 2019).

This paper aims to expand on previous findings by investigating ethnic disparities in parkrun participation. We combined geo-spatial data, provided by parkrun and available through the ONS, and fitted multivariable Poisson regression models to study the effect of ethnic minorities on participation rates at the aggregate census area level.

We find that areas with a higher proportion of ethnic minorities had lower participation rates. This effect is independent of  Areas with high deprivation and a high proportion of ethnic minorities have the lowest participation rates. parkrun should increase their efforts to engage with these communities and reduce potential barriers to participation.

# Introduction

There is strong evidence from survey data that ethnic minority individuals in England are less likely to be physcially active, and to engage in sport in general [Sport England](https://www.sportengland.org/media/3513/sports-participation-and-ethnicity-in-england-headline-findings.pdf). 

Previous analysis has been conducted investigating the factors associated with higher levels of partcipation [Cleland et al., 2019](https://journals.sagepub.com/doi/pdf/10.1177/0890117118770106?casa_token=WIfzcbwmyFoAAAAA:v2iYFcITA7-__9Xn3pZvS9GRw-aIvKkDGLU1bU6__behSpsm__LwcvkTGclu79R42FECROneYL5N). However, due to the biases associated with surveying only parkrun participants the findings have no external validity (i.e. estimating the relationship between education and number of runs once engaged with parkrun does not tell us about the determinants of initial engagement with parkrun). The authors themselves note the limitation that "The sample was limited to a nonrandom sample of parkrun participants in one State of Australia and may not be generalizable to other parkrun populations." (p.21).

Previous research found IMD very important and ethnic diversity low [goyder et al. 2018](https://jech.bmj.com/content/jech/72/Suppl_1/A61.2.full.pdf) "community events of this nature are, whilst likely to provide health benefits to the population as a whole, also likely to
be responsible for significant intervention generated inequalities in uptake of opportunities for physically active recreation."

Parkrun huge potential impact [Stevinson et al. 2013](https://academic.oup.com/jpubhealth/article/36/2/268/1548895).
and [Stevinson et al. 2019](https://academic.oup.com/jpubhealth/advance-article/doi/10.1093/pubmed/fdy178/5123524).


# Methods

Data was obtained from multiple sources at the Lower layer Super Output Level, which are geographical areas containing around 1,000-3,000 people. There are 32844 LSOAs in England. [parkrunUK](https://www.parkrun.org.uk/) provided data on the number of runs from each LSOA in England between the dates XXX and XXX. The ethnic breakdown of each LSOA was obtained from the Office of National Statistics (ONS) [here](https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/lowersuperoutputareamidyearpopulationestimates). The deprivation scores & population sizes for each LSOA was obtained from the ONS. More information can be found [here](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/835115/IoD2019_Statistical_Release.pdf). The population density for each LSOA was obtained from the ONS [here](https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/lowersuperoutputareapopulationdensity). The geographic weighted centroids for each LSOA were obtained from the ONS [here](http://census.ukdataservice.ac.uk/get-data/boundary-data.aspx). The location of each parkrun event was obtained from the parkrunUK website [here](https://www.parkrun.org.uk/).

| Variable        | Description           | Source  |
| :----- |:--------| :---------|
| run_count     | number of runs from each LSOA in England between XXX and XXX | parkrunUK |
| imd           | IMD scores for each LSOA      |   https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/835115/IoD2019_Statistical_Release.pdf |
| total_pop | total number of individuals in each LSOA     |    https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/835115/IoD2019_Statistical_Release.pdf |
| pop_density     | population density for each LSOA | https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/lowersuperoutputareapopulationdensity |
| perc_bme    | percent of population non-white-british | https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/lowersuperoutputareamidyearpopulationestimates | 
| mn_dstn     | distance from LSOA centroid to nearest parkrun | derived|
| perc_non_working_age | derived from ONS data on age-groups in each LSOA | derived |
| run_rate    | derived from run_count and LSAO populations | derived |

After merging these datasets we had detailed data on 32844 LSOAs participation in parkrun and several characteristics of the LSOAs which we hypothesised may influence participation. Since previous work has found corelations between participation and deprivation, distance to nearest event, and population density we included all of these variables. We also extended the analysis to include the percent of the population of black and ethnic minority and the percent of the population who are working age. We included ethnicity as we hypothesised that areas with higher percentages of residents of ethnic minorities would have lower participation rates. We included the percent of the population that is working age as a control to limit for the effect of populations heavily skewed toward older people (e.g. care homes), or very young people (e.g orphanages/immediately around special needs schools)). Since participation in parkrunUK is dominated by those aged 20-60 we felt this was justified.   

We used R Software Environment to produce simple summary statistics and viewed simple correlations between the variables described. We then moved on to estimate the partial correlation coefficients between the variables, before running a poisson regression model on scaled data to estimate the relative influence of several determinants on parkrun participation.

# Results
Participation in parkrun varies between LSOAs. Around half of all communities (LSOA) average less than 1 run per week per 1000 people. Approximately a quarter average between 1 and 2 runs, and around an eighth between 2 and 3 runs.

```{r, echo = F,fig.height=5, fig.width=8}
library(reshape2)
library(dplyr)
library(tidyverse)
library(ggplot2)
library("viridis")
#install.packages("corrplot")
library(corrplot)
library(ggplot2)
library(fitdistrplus)

rm(list = ls())

# setwd('C:/Users/Robert/Google Drive/Other Projects/PARKRUN/DoPE')

df <- read.csv("../output/lsoa_df.csv") %>% 
        mutate(run_rate = run_count/total_pop * 1000/52)

ggplot(data=df, aes(run_rate)) + 
  
  geom_histogram(aes(y =..density..), 
                 breaks=seq(0, 800/52, by = 1), 
                 col="darkgreen", 
                 fill="green", 
                 alpha = .2) + 
  
  #geom_density(col=2) + 

  theme_minimal() +
  
  labs(title="Distribution of LSOA parkrun participation rate") +
  
  labs(x="Average weekly runs per 1000 people", y = "Density")

```

## Correlation Matrix
There is a negative correlation between particpation (run_count) and deprivation (imd), distance to nearest parkrun (mn_distance), population density (pop_density) and percent BME (perc_bme). Percent BME was strongly postively correlated with population density, negatively correlated with percent non-working age, and moderately positvely correlated with IMD  suggesting that areas with more BME residents are more densely populated, more deprived and have fewer older people.

```{r, echo = F,fig.height=5, fig.width=8}


# setwd('C:/Users/Robert/Google Drive/Other Projects/PARKRUN/DoPE')

## CORRELATION MATRIX IMD ONLY
cor_mat <-  read.csv("../output/lsoa_df.csv") %>%
              dplyr::select(run_count,imd, perc_bme, mn_dstn,  
                      total_pop, pop_density,perc_non_working_age) %>%
              cor
      
rownames(cor_mat) <-  colnames(cor_mat) <- substr(colnames(cor_mat),1,20)

corrplot(corr = cor_mat,
         addCoef.col = "black",
         type = "upper",
         title = "Correlation of Variables")

```


## Association plot
```{r, echo = F,fig.height=5, fig.width=8}

df <-  read.csv("../output/lsoa_df.csv") %>%
              dplyr::select(run_count,imd, perc_bme, mn_dstn,
                      total_pop, pop_density,perc_non_working_age)

## hist bme
# ggplot(df) +
#   geom_histogram(aes(perc_bme),fill="cyan",alpha=0.5,col="blue")

# boxplots  run_count~ bme_10
# bme_10 = cut(df$perc_bme,breaks = quantile(df$perc_bme,probs=seq(0,1,by=0.1)),include.lowest = T)
# ggplot(df) +
#   geom_boxplot(aes(y=run_count,fill= bme_10,x=bme_10)) +
#   ylim(c(0,500)) +
#   theme()


## Association plot
# ggplot(df) +
#   geom_point(aes(x=perc_bme*100,y=run_count),col="purple",alpha=0.3,size=0.5) +
#   geom_smooth(aes(x=perc_bme*100,y=run_count)) +
#   labs(y="Average weekly runs per 1000 people", x = "% ethnic minorities") +
#   ylim(c(0,750)) +  # outliers excluded
#   theme_minimal()
# 
# 
# ggplot(df) +
#   geom_point(aes(x=perc_bme*100,y=imd),col="darkorange",alpha=0.3,size=0.5) +
#   geom_smooth(aes(x=perc_bme*100,y=imd)) +
#   labs(y="IMD score", x = "% ethnic minorities") +
#   theme_minimal()
# 
# 
# ggplot(df) +
#   geom_point(aes(x=imd,y=run_count),col="cyan",alpha=0.4,size=0.5) +
#   geom_smooth(aes(x=perc_bme*100,y=run_count)) +
#   labs(y="Average weekly runs per 1000 people", x = "IMD") +
#   ylim(c(0,750)) +  # outliers excluded
#   theme_minimal()


# joint smooth association plot

bme_5 = cut(df$perc_bme,breaks = quantile(df$perc_bme,probs=seq(0,1,by=0.2)),include.lowest = T)

ggplot(df) +
  geom_point(aes(x=imd,y=run_count),col="darkgray",alpha=.3,size=.5) +
  geom_smooth(aes(x=imd,y=run_count,col=bme_5)) +
  xlab("Multiple deprivation") +
  ylim(c(0,500)) +
  ylab("Average weekly runs per 1000 people") +
  theme_minimal() +
  scale_color_manual(values= c(2,3,4,5,6),name="% bme quintiles",labels=c("Lowest","low","median","high","highest"))

```


## Colour plot

We are interested in particular in how participation in parkrun varies by the percent BME and IMD of the community. We split our LSOA into deciles based on the two variables and represent the mean participation rate for LSOAs which fall into the repsective deciles (e.g. 2,5 means decile 2 for BME and 5 for IMD) as a colour on the plot. 

The plot shows that participation is lowest in areas with the highest deprivation, and that there is a complex relationship between ethnicity and participation, with higher participation in areas with moderately high percentage BME. 

```{r, echo=F,fig.height=5, fig.width=8}
# RUN RATE
df <- read.csv("../output/lsoa_df.csv") %>% 
  
        mutate(run_rate = run_count/total_pop,
               imd_dec = cut(x = imd,
                               breaks = quantile(imd,seq(0,1,0.1)),
         ordered_result = T,
         labels = F),
         bme_dec= cut(x = perc_bme,
                      breaks = quantile(perc_bme,seq(0,1,0.1)),
                              ordered_result = T,
                              labels = F))%>%
                 
        melt(id.vars = c("code","imd_dec","bme_dec","pop_density"),
             measure.vars ="run_rate", 
             value.name = "run_rate") %>%
  
        dplyr::select(imd_dec,bme_dec,run_rate,pop_density)

# df$pop_density_bins = cut(df$pop_density,
#                           quantile(df$pop_density,
#                                    probs = c(0,0.25,0.5,0.75,1)),
#                           include.lowest = T,
#                           labels = c("Lowest density","low density","high density","highest density"))

df <- aggregate(run_rate ~ bme_dec + imd_dec, # + pop_density_bins, 
                data = df, 
                FUN= "mean")

ggplot(data = df,
       aes(as.factor(bme_dec), as.factor(imd_dec), fill= run_rate)) + 
  geom_tile()+
  scale_fill_viridis(discrete=FALSE) +
  xlab("% Ethnic minorities (percentiles)")+
  ylab("Multiple Deprivation Index (percentiles)") # + facet_wrap(~pop_density_bins,nrow = 2)

# ACCESS
#
#df <- read.csv("../output/lsoa_df.csv")%>% 
#  
#        mutate(run_rate = run_count/total_pop,
#               imd_quint = cut(x = imd,
#                               breaks = #quantile(imd,seq(0,1,0.1)),
#                               ordered_result = T,
#                               labels = F),
#               bme_quint= cut(x = perc_bme,
#                              breaks = #quantile(perc_bme,seq(0,1,0.1)),
#                              ordered_result = T,
#                              labels = F))%>%
#                 
#        melt(id.vars = c("code","imd_quint","bme_quint"),
#             measure.vars ="mn_dstn", 
#             value.name = "mn_dstn") %>%
#  
#        select(imd_quint,bme_quint,mn_dstn)
#
#df <- aggregate(mn_dstn ~ imd_quint + bme_quint, data = df, #FUN= "mean" )
#
#ggplot(data = df,
#       aes(imd_quint, bme_quint, fill= mn_dstn)) + 
#  geom_tile()+
#  scale_fill_viridis(discrete=FALSE)

```

In order to control for confounders, we created a partial correlation matrix. This estimates the correlation between the variables in the analysis holding all other variables constant.

Looking at the top row, it is clear that participation rates and deprivation is strongly correlated, but less so now we are controlling for other variables. Distance is also strongly correlated, as our previous analysis published in XXX showed. The percent BME is also negatively correlated, suggesting that some of the relationship between participation and IMD is attributable to the ethnicity of residents.

## Partial correlation matrix
```{r echo=FALSE, fig.height=5, fig.width=8}
library(psych)

df <- read.csv("../output/lsoa_df.csv") %>% 
  
        mutate(run_rate = run_count/total_pop) %>%

        dplyr::select(run_rate,imd,perc_bme,
               mn_dstn,pop_density,
               perc_non_working_age)

# partial correlation plot for all variables
partial.r(data = df) %>%
      corrplot(addCoef.col = "black",
                     type = "upper",
                     title = "Correlation of Variables")
 

     
# partial correlation plot for three key variables holding others constant.
#include <- c("run_rate","perc_bme","imd")
#constant <- c("pop_density","perc_non_working_age","mn_dstn")
#
#partial.r(data = df,
#          x = include,
#          y = constant) %>%
#      corrplot(addCoef.col = "black",
#               type = "upper",
#               title = "Correlation of Variables")


```

## Poissson Model

Poisson models are commonly used to estimate count data, where values are constrained by 0. In this case, because it is not possible for a community to have negative participation we use a Poisson regression.

The results of the poisson regression are not notoriously easy to interpret, but show that areas with a higher percent of residents who are non-White-British have lower participation rates, even when controlling for the effect of deprivation and distance to events. The effect is smaller than deprivation and distance, but still sizeable and significant. 


<!-- NOTE: we could show bivariate regression for each of the variables alone? -->


```{r, echo = FALSE,results='asis'}
library(stargazer)
rm(list = ls())

df <- read.csv("../output/lsoa_df.csv")

df$pop_density = log(df$pop_density )  # tranforming pop_density to log scale

#===
# Model 1: Poisson model imd all as one.
#===


model1 = glm(run_count ~ imd + pop_density + mn_dstn 
                         + perc_non_working_age + perc_bme,
             data = df,
             family = poisson(link="log"),
             offset = log(total_pop))


# stargazer(model1,ci=TRUE, ci.level=0.95)

x = summary(model1)
r2.1 = 1-((x$deviance-length(coef(x)[,1]))/x$null.deviance)
# r2.1

#===
# MODEL 2 - SCALED DATA   - allows easier interpretation of beta coefs 
#===  

# scale the dataframe
scaled_df <- data.frame(code = df$code,
                        run_count = df$run_count,
                        scale(df[,-c(1,2,12)]),
                        total_pop =df$total_pop,
                        stringsAsFactors = F)

# model 2
model2 <- glm(run_count ~ imd + mn_dstn + 
                perc_non_working_age + pop_density + perc_bme,
             data = scaled_df,
             family = poisson(link="log"),
             offset = log(total_pop))

# stargazer(model2,ci=TRUE, ci.level=0.95)

x <- summary(model2)
r2.2 = 1-((x$deviance-length(coef(x)[,1]))/x$null.deviance) # same fit
# r2.2

#===
# MODEL 3
#===

# model3 <-  glm(run_count ~ imd * perc_bme + mn_dstn,
#              data = scaled_df,
#              family = poisson(link="log"),
#              offset = log(total_pop))

#summary(model3)

# x = summary(model3)
# r2.3 = 1-((x$deviance-length(coef(x)[,1]))/x$null.deviance)
  

#===
# MODEL 4 - JUST IMD IMD, DISTANCE AND %BME
#===
model4 <- glm(run_count ~ imd + mn_dstn + perc_bme,
             data = scaled_df,
             family = poisson(link="log"),
             offset = log(total_pop))

# summary(model4)

x = summary(model4)
r2.4 = 1-((x$deviance-length(coef(x)[,1]))/x$null.deviance)


##### summary
stargazer(
  model1,model4,model2,
  column.labels	= c("Original scale","Scaled - min model","Scaled - full model"),
  ci=TRUE, ci.level=0.95,
  title="Regression Results")




#### bme percentile model
# bme_10 = cut(df$perc_bme,breaks = quantile(df$perc_bme,probs=seq(0,1,by=0.1)),include.lowest = T)
# model5 <- glm(run_count ~ imd + mn_dstn + 
#                 perc_non_working_age + pop_density + bme_10,
#              data = scaled_df,
#              family = poisson(link="log"),
#              offset = log(total_pop))
# 
# summary(model5)
# 
# x = summary(model5)
# r2.5 = 1-((x$deviance-length(coef(x)[,1]))/x$null.deviance)

```

    
# Discussion

Previous analysis by [Scheider et al., 2019](https://www.medrxiv.org/content/early/2019/08/29/19004143.full.pdf) has showed that participation in parkrun is lower in more deprived communities, and communities that are further from their nearest parkrun. This paper extends that analysis to include other community level characteristics which were hypothesized to influence parkrun participation. Our findings show that some of the negative effect on participation previously attributed to deprivation can actually be attributed to differences in participation by ethnic minotiries.

We find that communities with higher percentages of ethnic minority residents were less likely to participate in parkrun, even when controlling for deprivation. Since percentage ethnic minorotiy residents and deprivation are positively correlated, it is likely that some of the effect attributed to deprivation in our previous analysis [Scheider et al., 2019](https://www.medrxiv.org/content/early/2019/08/29/19004143.full.pdf) is is attributable to ethnicity. 

parkrun's mission states that they aim to increase levels of physical activity in deprived communities. Our findings indicate that participation in deprived communities with a high proportion of ethnic minorities is particularly low. parkrun should be consider incresing their efforts to reach minority communities. More research s needed to understand the barriers to attending parkrun for members of those communities. 

# Limitations

This analysis is cross-sectional, using data on participation in parkrun events between 1st January and 10th December. We have not studied how participation rates have changed over time, therefore it is possible that participation is changing at different rates in different LSOAs, and therefore deprived communities and communities with higher proportions of ethnic minority residents may be decreasing or increasing relative to the population average. It would be interesting to replicate this analysis for each year from 2010-2020 to see how parkrun has grown over time.

Our dependent variable is the number of runs by residents of each LSOA. This is a count variable where each run is treated equally (e.g. 10 runs by one person is equal to 1 run by 10 people). We cannot therefore draw inferences on the number of people who took part within each LSOA at some point in the year, but instead focus on the total run count.  

This analysis has been conducted at the LSOA level. Therefore we have been careful to say that participation is lower in areas with higher proportions of ethnic minority residents. It is not possible to make inferences about the effect of deprivation and ethnicity at a individual level from this data. However previous qualitative analysis [Goyder et al.,2018](https://jech.bmj.com/content/jech/72/Suppl_1/A61.2.full.pdf) has identified the small number of participants from ethnic minorities as an avenue for further research.

# References
